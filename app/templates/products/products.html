<!DOCTYPE html>
<html lang="es" data-theme="light" data-color-scheme="moderno" data-font-size="small">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Productos - QueVendi PRO</title>

    <!-- Google Fonts (V2 usa Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Base V2 -->
    <link rel="stylesheet" href="/static/css/base/layout.css">
    <link rel="stylesheet" href="/static/css/base/header.css">
    <link rel="stylesheet" href="/static/css/base/toast.css">
    <link rel="stylesheet" href="/static/css/base/modal.css">
    <link rel="stylesheet" href="/static/css/base/loader.css">

    <!-- Module -->
    <link rel="stylesheet" href="/static/css/products/products.css">

    <!-- Products page overrides -->
    <style>
        /* Override: esta p√°gina necesita scroll */
        html, body {
            overflow: auto;
            height: auto;
        }
        .main-content {
            position: relative;
            top: 0;
            overflow: visible;
            min-height: calc(100vh - 56px);
            padding-top: 56px; /* espacio para header fixed */
        }
        .main-content > .container {
            padding: 0;
        }
        /* Filters sticky debajo del header */
        .filters-bar {
            top: 56px;
        }
        /* SVG icons in header buttons inherit color */
        .header-btn svg {
            display: block;
        }
        /* FAB option SVG alignment */
        .fab-option-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fab-option-icon svg {
            display: block;
        }
    </style>
</head>
<body>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         HEADER V2 (de base_visual_completo)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <header class="header">
        <div class="header-left">
            <a href="/home" class="header-logo" title="Volver al POS">
                <div class="header-logo-icon">üõí</div>
                <span class="header-logo-text">QueVendi.pro</span>
            </a>
        </div>

        <div class="header-center">
            <div class="header-status" id="connection-status">
                <span class="status-dot status-online"></span>
                <span class="status-text">Conectado</span>
            </div>
        </div>

        <div class="header-right">
            <!-- Theme Toggle (luna/sol SVG) -->
            <button class="header-btn theme-toggle" id="theme-toggle" title="Modo claro/oscuro">
                <span class="theme-icon-light"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
                <span class="theme-icon-dark"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
            </button>

            <!-- Settings (sliders SVG - muy distinto a sol/luna) -->
            <button class="header-btn header-btn-settings" id="settings-btn" title="Configuraci√≥n visual">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
            </button>

            <!-- Notifications (bell SVG) -->
            <button class="header-btn" id="notifications-btn" title="Notificaciones">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                <span class="badge">3</span>
            </button>

            <!-- User Menu -->
            <div class="header-user" id="user-menu">
                <div class="header-user-avatar" id="header-avatar">DR</div>
                <div class="header-user-info">
                    <span class="header-user-name" id="header-username">Usuario</span>
                    <span class="header-user-role" id="header-role">Administrador</span>
                </div>
                <span class="dropdown-arrow">‚ñº</span>

                <div class="header-dropdown">
                    <a href="/home" class="dropdown-item">üè† Dashboard</a>
                    <a href="/productos" class="dropdown-item">üì¶ Productos</a>
                    <a href="/reports" class="dropdown-item">üìä Reportes</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item dropdown-item-danger" onclick="logout()">üö™ Cerrar Sesi√≥n</a>
                </div>
            </div>
        </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SETTINGS PANEL V2 (Lateral)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="settings-overlay" id="settings-overlay"></div>
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <span class="settings-title">Preferencias</span>
            <button class="modal-close" id="settings-close">√ó</button>
        </div>
        <div class="settings-body">
            <!-- Esquema de colores -->
            <div class="settings-section">
                <div class="settings-section-title">Esquema de Colores</div>
                <div class="color-schemes">
                    <button class="color-scheme-btn color-scheme-moderno active"
                            onclick="Settings.setColorScheme('moderno')"
                            title="Moderno (Azul/Verde)"></button>
                    <button class="color-scheme-btn color-scheme-calido"
                            onclick="Settings.setColorScheme('calido')"
                            title="C√°lido (Naranja/Rojo)"></button>
                    <button class="color-scheme-btn color-scheme-elegante"
                            onclick="Settings.setColorScheme('elegante')"
                            title="Elegante (P√∫rpura/Rosa)"></button>
                </div>
            </div>
            <!-- Tama√±o de texto -->
            <div class="settings-section">
                <div class="settings-section-title">Tama√±o de Texto</div>
                <div class="font-size-btns">
                    <button class="font-size-btn active" onclick="Settings.setFontSize('small')">Peque√±o</button>
                    <button class="font-size-btn" onclick="Settings.setFontSize('medium')">Mediano</button>
                    <button class="font-size-btn" onclick="Settings.setFontSize('large')">Grande</button>
                </div>
            </div>
            <!-- Posici√≥n de notificaciones -->
            <div class="settings-section">
                <div class="settings-section-title">Posici√≥n de Notificaciones</div>
                <div class="toast-position-grid">
                    <button class="toast-pos-btn active" onclick="Settings.setToastPosition('top-right')">‚ÜóÔ∏è Arr-Der</button>
                    <button class="toast-pos-btn" onclick="Settings.setToastPosition('top-center')">‚¨ÜÔ∏è Arr-Centro</button>
                    <button class="toast-pos-btn" onclick="Settings.setToastPosition('bottom-right')">‚ÜòÔ∏è Abj-Der</button>
                    <button class="toast-pos-btn" onclick="Settings.setToastPosition('bottom-center')">‚¨áÔ∏è Abj-Centro</button>
                </div>
            </div>
            <!-- Tema -->
            <div class="settings-section">
                <div class="settings-section-title">Tema</div>
                <div class="settings-option">
                    <span class="settings-option-label">Modo oscuro</span>
                    <label class="form-check" style="margin: 0;">
                        <input type="checkbox" id="dark-mode-toggle" onchange="Settings.toggleDarkMode()">
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         MAIN CONTENT - PRODUCTOS
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <main class="main-content">

        <!-- ‚îÄ‚îÄ Stats Bar ‚îÄ‚îÄ -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-card active" data-filter="all">
                <span class="stat-value" id="statTotal">-</span>
                <span class="stat-label">Total</span>
            </div>
            <div class="stat-card stat-active" data-filter="active">
                <span class="stat-value" id="statActive">-</span>
                <span class="stat-label">Activos</span>
            </div>
            <div class="stat-card stat-low" data-filter="low">
                <span class="stat-value" id="statLow">-</span>
                <span class="stat-label">Stock bajo</span>
            </div>
            <div class="stat-card stat-out" data-filter="out">
                <span class="stat-value" id="statOut">-</span>
                <span class="stat-label">Agotados</span>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Inventory Value ‚îÄ‚îÄ -->
        <div class="inventory-summary" id="inventorySummary">
            <div class="inv-item">
                <span class="inv-label">Valor inventario</span>
                <span class="inv-value" id="invValue">S/ -</span>
            </div>
            <div class="inv-sep"></div>
            <div class="inv-item">
                <span class="inv-label">Ganancia est.</span>
                <span class="inv-value inv-profit" id="invProfit">S/ -</span>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Search & Filters ‚îÄ‚îÄ -->
        <div class="filters-bar">
            <div class="search-wrap">
                <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18"><circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5L21 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar producto o alias..." autocomplete="off">
                <button class="search-clear" id="searchClear" title="Limpiar">&times;</button>
            </div>
            <div class="filter-row">
                <select id="filterCategory" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                </select>
                <select id="filterStock" class="filter-select">
                    <option value="">Todo stock</option>
                    <option value="normal">Normal</option>
                    <option value="low">Stock bajo</option>
                    <option value="out">Agotado</option>
                </select>
                <select id="sortBy" class="filter-select">
                    <option value="name-asc">A ‚Üí Z</option>
                    <option value="name-desc">Z ‚Üí A</option>
                    <option value="sale_price-desc">Precio ‚Üì</option>
                    <option value="sale_price-asc">Precio ‚Üë</option>
                    <option value="stock-asc">Menos stock</option>
                    <option value="stock-desc">M√°s stock</option>
                </select>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Products Grid ‚îÄ‚îÄ -->
        <div class="products-container" id="productsContainer">
            <!-- Filled by JS -->
        </div>

        <!-- ‚îÄ‚îÄ Pagination (moved outside main for fixed positioning) ‚îÄ‚îÄ -->

        <!-- ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ -->
        <div class="empty-state" id="emptyState" style="display:none;">
            <div class="empty-icon">üì¶</div>
            <div class="empty-title">No hay productos</div>
            <div class="empty-text">Importa un cat√°logo o agrega productos manualmente</div>
            <button class="btn btn-primary" onclick="ProductsApp.openImportModal()">Importar cat√°logo</button>
        </div>

    </main>

    <!-- ‚ïê‚ïê‚ïê Pagination (fixed bottom bar) ‚ïê‚ïê‚ïê -->
    <div class="pagination" id="pagination"></div>

    <!-- ‚ïê‚ïê‚ïê FAB (Floating Action Button) ‚ïê‚ïê‚ïê -->
    <div class="fab-container" id="fabContainer">
        <button class="fab-main" id="fabMain" title="Acciones">
            <svg viewBox="0 0 24 24" width="28" height="28"><path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>
        </button>
        <div class="fab-menu" id="fabMenu">
            <button class="fab-option" onclick="ProductsApp.openCreateModal()">
                <span class="fab-option-icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg></span>
                <span class="fab-option-label">Nuevo producto</span>
            </button>
            <button class="fab-option" onclick="ProductsApp.openImportModal()">
                <span class="fab-option-icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span>
                <span class="fab-option-label">Importar cat√°logo</span>
            </button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Crear/Editar Producto ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalProduct">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modalProductTitle">Nuevo producto</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalProduct')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProduct" onsubmit="return false;">
                    <input type="hidden" id="prodId">

                    <!-- Tab nav -->
                    <div class="tabs">
                        <button type="button" class="tab active" data-tab="tabBasic">B√°sico</button>
                        <button type="button" class="tab" data-tab="tabExtras">Extras</button>
                        <button type="button" class="tab" data-tab="tabMayoreo">Mayoreo</button>
                    </div>

                    <!-- Tab: B√°sico -->
                    <div class="tab-panel active" id="tabBasic">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="prodName" required maxlength="200" placeholder="Ej: Coca Cola 500ml">
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Precio venta *</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodPrice" required min="0.01" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Costo</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodCost" min="0" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Stock</label>
                                <input type="number" id="prodStock" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Stock m√≠nimo</label>
                                <input type="number" id="prodMinStock" min="0" value="5">
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Categor√≠a</label>
                                <input type="text" id="prodCategory" list="categoryList" placeholder="Bebidas, Abarrotes...">
                                <datalist id="categoryList"></datalist>
                            </div>
                            <div class="form-group">
                                <label>Unidad</label>
                                <select id="prodUnit">
                                    <option value="UND">Unidad</option>
                                    <option value="KG">Kilogramo</option>
                                    <option value="LT">Litro</option>
                                    <option value="DOC">Docena</option>
                                    <option value="PAQ">Paquete</option>
                                    <option value="CJ">Caja</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Marca</label>
                            <input type="text" id="prodBrand" placeholder="Ej: Gloria, Alicorp...">
                        </div>
                        <div class="form-group">
                            <label>C√≥digo de barras</label>
                            <input type="text" id="prodBarcode" placeholder="Escanear o escribir">
                        </div>
                    </div>

                    <!-- Tab: Extras -->
                    <div class="tab-panel" id="tabExtras">
                        <div class="form-group">
                            <label>Aliases (para voz y b√∫squeda)</label>
                            <div class="chips-input" id="aliasesChips">
                                <div class="chips-list" id="aliasesList"></div>
                                <input type="text" id="aliasInput" placeholder="Escribe y presiona Enter" class="chip-input-field">
                            </div>
                            <small class="form-hint">Nombres alternativos: "coca", "gaseosa roja", "tarro"</small>
                        </div>
                        <div class="form-group">
                            <label>Tags</label>
                            <div class="chips-input" id="tagsChips">
                                <div class="chips-list" id="tagsList"></div>
                                <input type="text" id="tagInput" placeholder="Escribe y presiona Enter" class="chip-input-field">
                            </div>
                            <small class="form-hint">Agrupaci√≥n: "alta_rotacion", "lonchera", "verano"</small>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="prodDescription" rows="2" placeholder="Opcional"></textarea>
                        </div>
                    </div>

                    <!-- Tab: Mayoreo -->
                    <div class="tab-panel" id="tabMayoreo">
                        <div class="mayoreo-info">
                            <p>Configura precios especiales por cantidad. Si el cliente compra m√°s de la cantidad m√≠nima, se aplica el precio de mayoreo.</p>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Cantidad m√≠nima</label>
                                <input type="number" id="prodMayoreoQty" min="2" placeholder="Ej: 6">
                            </div>
                            <div class="form-group">
                                <label>Precio mayoreo</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodMayoreoPrice" min="0.01" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nota</label>
                            <input type="text" id="prodMayoreoNote" maxlength="100" placeholder="Ej: Pack 6 unidades, Caja 12 botellas">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalProduct')">Cancelar</button>
                <button class="btn btn-primary" id="btnSaveProduct" onclick="ProductsApp.saveProduct()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Importar Cat√°logo ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalImport">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Importar cat√°logo</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalImport')">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle">Selecciona cat√°logos para cargar productos con precios sugeridos, aliases y datos inteligentes.</p>
                <div class="catalogs-grid" id="catalogsGrid"></div>
                <div class="import-preview" id="importPreview" style="display:none;">
                    <div class="preview-header">
                        <h4 id="previewTitle">-</h4>
                        <span class="preview-count" id="previewCount">0 productos</span>
                    </div>
                    <div class="preview-categories" id="previewCategories"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalImport')">Cancelar</button>
                <button class="btn btn-primary" id="btnImport" onclick="ProductsApp.importCatalog()" disabled>Importar seleccionados</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Ajustar Stock ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalStock">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Ajustar stock</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalStock')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-product-name" id="stockProductName">-</div>
                <div class="stock-current">Stock actual: <strong id="stockCurrent">0</strong></div>
                <input type="hidden" id="stockProductId">
                <div class="stock-controls">
                    <button class="stock-btn stock-minus" onclick="ProductsApp.adjustStockInput(-1)">‚àí</button>
                    <input type="number" id="stockQty" value="0" class="stock-qty-input">
                    <button class="stock-btn stock-plus" onclick="ProductsApp.adjustStockInput(1)">+</button>
                </div>
                <div class="stock-presets">
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(-1)">-1</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(-5)">-5</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(5)">+5</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(10)">+10</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(24)">+24</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(48)">+48</button>
                </div>
                <div class="form-group" style="margin-top:12px;">
                    <label>Motivo</label>
                    <select id="stockReason">
                        <option value="Compra proveedor">Compra proveedor</option>
                        <option value="Ajuste inventario">Ajuste inventario</option>
                        <option value="Merma">Merma</option>
                        <option value="Devoluci√≥n">Devoluci√≥n</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalStock')">Cancelar</button>
                <button class="btn btn-primary" onclick="ProductsApp.saveStock()">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Cambio r√°pido de precio ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalPrice">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Cambiar precio</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalPrice')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-product-name" id="priceProductName">-</div>
                <div class="stock-current">Precio actual: <strong id="priceCurrent">S/ 0</strong></div>
                <input type="hidden" id="priceProductId">
                <div class="form-group">
                    <label>Nuevo precio de venta</label>
                    <div class="input-prefix input-large">
                        <span>S/</span>
                        <input type="number" id="priceNew" min="0.01" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Nuevo costo (opcional)</label>
                    <div class="input-prefix">
                        <span>S/</span>
                        <input type="number" id="priceCostNew" min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalPrice')">Cancelar</button>
                <button class="btn btn-primary" onclick="ProductsApp.savePrice()">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê Toast Container V2 ‚ïê‚ïê‚ïê -->
    <div id="toast-container" class="toast-container toast-top-right"></div>

    <!-- ‚ïê‚ïê‚ïê Loader V2 (Con icono por nicho) ‚ïê‚ïê‚ïê -->
    <div class="loader-overlay" id="loader-overlay">
        <div class="loader-icon" id="loader-icon">üõí</div>
        <div class="loader-text">Cargando...</div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         JAVASCRIPT
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- V2 Base: Settings + UserMenu + Toast + Modal + Loader (inline, del base_visual_completo) -->
    <script>
    /* ‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê */
    const Settings = {
        defaults: { theme: 'light', colorScheme: 'moderno', fontSize: 'small', toastPosition: 'top-right' },

        init() {
            const saved = JSON.parse(localStorage.getItem('userSettings') || '{}');
            const config = { ...this.defaults, ...saved };
            this.setTheme(config.theme, false);
            this.setColorScheme(config.colorScheme, false);
            this.setFontSize(config.fontSize, false);
            this.setToastPosition(config.toastPosition, false);
            document.getElementById('dark-mode-toggle').checked = config.theme === 'dark';
            document.getElementById('settings-btn').addEventListener('click', () => this.openPanel());
            document.getElementById('settings-close').addEventListener('click', () => this.closePanel());
            document.getElementById('settings-overlay').addEventListener('click', () => this.closePanel());
            document.getElementById('theme-toggle').addEventListener('click', () => this.toggleDarkMode());
        },

        save() {
            const config = {
                theme: document.documentElement.getAttribute('data-theme'),
                colorScheme: document.documentElement.getAttribute('data-color-scheme'),
                fontSize: document.documentElement.getAttribute('data-font-size'),
                toastPosition: Toast.config.position
            };
            localStorage.setItem('userSettings', JSON.stringify(config));
        },

        openPanel() {
            document.getElementById('settings-panel').classList.add('active');
            document.getElementById('settings-overlay').classList.add('active');
        },

        closePanel() {
            document.getElementById('settings-panel').classList.remove('active');
            document.getElementById('settings-overlay').classList.remove('active');
        },

        setTheme(theme, showToast = true) {
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('dark-mode-toggle').checked = theme === 'dark';
            this.save();
            if (showToast) Toast.info(theme === 'dark' ? 'Modo oscuro' : 'Modo claro');
        },

        toggleDarkMode() {
            const current = document.documentElement.getAttribute('data-theme');
            this.setTheme(current === 'dark' ? 'light' : 'dark');
        },

        setColorScheme(scheme, showToast = true) {
            document.documentElement.setAttribute('data-color-scheme', scheme);
            document.querySelectorAll('.color-scheme-btn').forEach(btn => btn.classList.remove('active'));
            const btn = document.querySelector(`.color-scheme-${scheme}`);
            if (btn) btn.classList.add('active');
            this.save();
            const names = { moderno: 'Moderno', calido: 'C√°lido', elegante: 'Elegante' };
            if (showToast) Toast.info(`Tema ${names[scheme]}`);
        },

        setFontSize(size, showToast = true) {
            document.documentElement.setAttribute('data-font-size', size);
            document.querySelectorAll('.font-size-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.font-size-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(size === 'small' ? 'peque√±o' : size === 'medium' ? 'mediano' : 'grande')) {
                    btn.classList.add('active');
                }
            });
            this.save();
            const names = { small: 'Peque√±o', medium: 'Mediano', large: 'Grande' };
            if (showToast) Toast.info(`Texto ${names[size]}`);
        },

        setToastPosition(position, showToast = true) {
            Toast.setPosition(position);
            document.querySelectorAll('.toast-pos-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.toast-pos-btn').forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(position)) {
                    btn.classList.add('active');
                }
            });
            this.save();
            const names = { 'top-right': 'Arriba derecha', 'top-center': 'Arriba centro', 'bottom-right': 'Abajo derecha', 'bottom-center': 'Abajo centro' };
            if (showToast) Toast.info(`Notificaciones: ${names[position]}`);
        }
    };

    /* ‚ïê‚ïê‚ïê USER MENU ‚ïê‚ïê‚ïê */
    const UserMenu = {
        init() {
            const menu = document.getElementById('user-menu');
            menu.addEventListener('click', (e) => {
                e.stopPropagation();
                menu.classList.toggle('active');
            });
            document.addEventListener('click', () => menu.classList.remove('active'));
        }
    };

    /* ‚ïê‚ïê‚ïê TOAST V2 ‚ïê‚ïê‚ïê */
    const Toast = {
        container: null,
        config: { position: 'top-right', duration: 3500, maxToasts: 4 },

        init() {
            this.container = document.getElementById('toast-container');
        },

        show(message, type = 'info', title = '') {
            const existing = this.container.querySelectorAll('.toast');
            if (existing.length >= this.config.maxToasts) existing[0].remove();

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†', info: '‚Ñπ' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <div class="toast-content">
                    ${title ? `<div class="toast-title">${title}</div>` : ''}
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="Toast.dismiss(this.parentElement)">√ó</button>
            `;

            if (this.config.position.includes('bottom')) {
                this.container.prepend(toast);
            } else {
                this.container.appendChild(toast);
            }

            requestAnimationFrame(() => toast.classList.add('toast-show'));
            if (this.config.duration > 0) {
                setTimeout(() => this.dismiss(toast), this.config.duration);
            }
            return toast;
        },

        dismiss(toast) {
            if (!toast || !toast.parentElement) return;
            toast.classList.remove('toast-show');
            toast.classList.add('toast-hide');
            setTimeout(() => toast.remove(), 300);
        },

        setPosition(position) {
            this.config.position = position;
            this.container.className = `toast-container toast-${position}`;
        },

        success(msg, title = '') { return this.show(msg, 'success', title); },
        error(msg, title = '') { return this.show(msg, 'error', title); },
        warning(msg, title = '') { return this.show(msg, 'warning', title); },
        info(msg, title = '') { return this.show(msg, 'info', title); }
    };

    /* ‚ïê‚ïê‚ïê MODAL V2 ‚ïê‚ïê‚ïê */
    const Modal = {
        open(id) {
            const modal = document.getElementById(id);
            if (modal) { modal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        },
        close(id) {
            const modal = document.getElementById(id);
            if (modal) { modal.classList.remove('active'); document.body.style.overflow = ''; }
        }
    };

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
            Settings.closePanel();
            document.body.style.overflow = '';
        }
    });

    /* ‚ïê‚ïê‚ïê LOADER V2 ‚ïê‚ïê‚ïê */
    const Loader = {
        icons: { bodega: 'üõí', minimarket: 'üõí', restaurante: 'üçΩÔ∏è', cafeteria: '‚òï', farmacia: 'üíä', ferreteria: 'üîß', libreria: 'üìö', default: '‚è≥' },
        show(nicho = 'bodega') {
            const icon = this.icons[nicho] || this.icons.default;
            document.getElementById('loader-icon').textContent = icon;
            document.getElementById('loader-overlay').classList.add('active');
        },
        hide() {
            document.getElementById('loader-overlay').classList.remove('active');
        }
    };

    /* ‚ïê‚ïê‚ïê HEADER USER DATA ‚ïê‚ïê‚ïê */
    function loadHeaderUser() {
        const token = localStorage.getItem('token');
        if (!token) return;
        fetch('/api/v1/users/me', { headers: { 'Authorization': `Bearer ${token}` } })
            .then(r => r.json())
            .then(user => {
                if (user && user.name) {
                    const initials = user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                    document.getElementById('header-avatar').textContent = initials;
                    document.getElementById('header-username').textContent = user.name;
                    document.getElementById('header-role').textContent = user.role === 'owner' ? 'Administrador' : 'Vendedor';
                }
            })
            .catch(() => {});
    }

    function logout() {
        localStorage.removeItem('token');
        window.location.href = '/auth/login';
    }

    /* ‚ïê‚ïê‚ïê INIT V2 BASE ‚ïê‚ïê‚ïê */
    document.addEventListener('DOMContentLoaded', () => {
        Toast.init();
        UserMenu.init();
        Settings.init();
        loadHeaderUser();
    });
    </script>

    <!-- Module: Products App -->
    <script src="/static/js/products/products.js"></script>
</body>
</html>