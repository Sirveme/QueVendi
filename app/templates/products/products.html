<!DOCTYPE html>
<html lang="es" data-theme="light" data-color-scheme="moderno" data-font-size="small">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Productos - QueVendi PRO</title>

    <!-- Google Fonts (V2 usa Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Base V2 -->
    <link rel="stylesheet" href="/static/css/base/layout.css?v=20260224c">
    <link rel="stylesheet" href="/static/css/base/header.css?v=20260224c">
    <link rel="stylesheet" href="/static/css/base/toast.css?v=20260224c">
    <link rel="stylesheet" href="/static/css/base/modal.css?v=20260224c">
    <link rel="stylesheet" href="/static/css/base/loader.css?v=20260224c">

    <!-- Module -->
    <link rel="stylesheet" href="/static/css/products/products.css?v=20260224c">

    <!-- Products page overrides -->
    <style>
        /* Override: esta pÃ¡gina necesita scroll */
        html, body {
            overflow: auto;
            height: auto;
        }
        .main-content {
            position: relative;
            top: 0;
            overflow: visible;
            min-height: calc(100vh - 56px);
            padding-top: 56px; /* espacio para header fixed */
        }
        .main-content > .container {
            padding: 0;
        }
        /* Filters sticky debajo del header */
        .filters-bar {
            top: 56px;
        }
        /* SVG icons in header buttons inherit color */
        .header-btn svg {
            display: block;
        }
        /* FAB option SVG alignment */
        .fab-option-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fab-option-icon svg {
            display: block;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CRITICAL: Dark/Light mode card theming
           Inline para garantizar que aplique sin
           depender de cachÃ© de products.css
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .product-card {
            background: var(--card-bg, #fff) !important;
            border-color: var(--border-color, #e7e5e4) !important;
        }
        .product-card .pc-name { color: var(--text-primary); }
        .product-card .pc-meta { color: var(--text-secondary); }
        .product-card .pc-category { background: var(--bg-tertiary); }
        .product-card .pc-price { color: var(--color-primary); }

        .product-card .pc-action-btn {
            background: var(--card-bg, #fff);
            border-color: var(--border-color, #e7e5e4);
            color: var(--text-secondary);
        }

        .stat-card {
            background: var(--card-bg, #fff) !important;
            border-color: var(--border-color, #e7e5e4) !important;
        }
        .stat-card .stat-value { color: var(--text-primary); }
        .stat-card .stat-label { color: var(--text-secondary); }
        .stat-card.active {
            border-color: var(--color-primary) !important;
            background: var(--color-primary-light) !important;
        }

        .inventory-summary {
            background: var(--card-bg, #fff) !important;
            border-color: var(--border-color, #e7e5e4) !important;
        }
        .inventory-summary .inv-value { color: var(--text-primary); }
        .inventory-summary .inv-label { color: var(--text-secondary); }

        .search-input {
            background: var(--input-bg, #fff) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }
        .filter-select {
            background: var(--input-bg, #fff) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        .filters-bar {
            background: var(--bg-secondary) !important;
        }

        .pagination {
            background: color-mix(in srgb, var(--bg-secondary) 82%, transparent) !important;
            border-top-color: var(--border-color) !important;
        }
        .page-btn {
            background: var(--card-bg) !important;
            color: var(--text-primary) !important;
            border-color: var(--border-color) !important;
        }
        .page-btn.active {
            background: var(--accent-gradient) !important;
            color: white !important;
            border-color: transparent !important;
        }

        /* Stock badge dark mode */
        .pc-stock-badge.normal { background: var(--color-success-bg); color: var(--color-success-text); }
        .pc-stock-badge.low { background: var(--color-warning-bg); color: var(--color-warning-text); }
        .pc-stock-badge.out { background: var(--color-error-bg); color: var(--color-error-text); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODAL - El base V2 usa .modal pero
           products usa .modal-content, hay que
           aplicar los estilos aquÃ­
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 1rem;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--card-bg, #fff);
            border: 1px solid var(--border-color, #e7e5e4);
            border-radius: 14px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            transform: scale(0.95) translateY(-10px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }
        .modal-content.modal-large { max-width: 540px; }
        .modal-content.modal-small { max-width: 380px; }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        .modal-close {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-tertiary);
            font-size: 1.25rem;
            transition: all 0.2s;
        }
        .modal-close:hover {
            background-color: var(--bg-hover);
            color: var(--text-primary);
        }
        .modal-body {
            padding: 1.25rem;
            overflow-y: auto;
            max-height: calc(85vh - 130px);
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            padding: 0.875rem 1.25rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-tertiary);
        }

        /* Form elements inside modals */
        .modal-content .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .modal-content .form-group input,
        .modal-content .form-group select,
        .modal-content .form-group textarea {
            width: 100%;
            padding: 9px 12px;
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: border-color 0.2s;
            box-sizing: border-box;
        }
        .modal-content .form-group input:focus,
        .modal-content .form-group select:focus,
        .modal-content .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        .modal-content .form-group input::placeholder,
        .modal-content .form-group textarea::placeholder {
            color: var(--text-tertiary);
        }

        /* Input prefix (S/) inside modals */
        .modal-content .input-prefix {
            border-color: var(--border-color);
            background: var(--input-bg);
        }
        .modal-content .input-prefix span {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-right-color: var(--border-color);
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn-primary {
            background: var(--accent-gradient, var(--color-primary));
            color: #fff;
        }
        .btn-primary:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        /* Stock modal controls */
        .stock-product-name { color: var(--text-primary); }
        .stock-current { color: var(--text-secondary); }
        .stock-current strong { color: var(--text-primary); }
        .stock-btn {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        .stock-qty-input {
            background: var(--input-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        .preset-btn {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Tabs */
        .tabs {
            border-bottom-color: var(--border-color);
        }
        .tab {
            color: var(--text-secondary);
            font-family: inherit;
        }
        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        /* Mayoreo info */
        .mayoreo-info {
            background: var(--bg-tertiary);
        }
        .mayoreo-info p { color: var(--text-secondary); }

        /* Modal subtitle */
        .modal-subtitle { color: var(--text-secondary); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FAB menu options - fondo visible
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .fab-option {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: var(--shadow-md);
        }
        .fab-option:hover {
            border-color: var(--color-primary) !important;
        }
        .fab-option-label {
            color: var(--text-primary);
        }
        .fab-option-icon svg {
            stroke: var(--text-secondary);
        }
        .fab-option:hover .fab-option-icon svg {
            stroke: var(--color-primary);
        }
    </style>
</head>
<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HEADER V2 (de base_visual_completo)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="header">
        <div class="header-left">
            <a href="/home" class="header-logo" title="Volver al POS">
                <div class="header-logo-icon">ğŸ›’</div>
                <span class="header-logo-text">QueVendi.pro</span>
            </a>
        </div>

        <div class="header-center">
            <div class="header-status" id="connection-status">
                <span class="status-dot status-online"></span>
                <span class="status-text">Conectado</span>
            </div>
        </div>

        <div class="header-right">
            <!-- Theme Toggle (luna/sol SVG) -->
            <button class="header-btn theme-toggle" id="theme-toggle" title="Modo claro/oscuro">
                <span class="theme-icon-light"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
                <span class="theme-icon-dark"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
            </button>

            <!-- Settings (sliders SVG - muy distinto a sol/luna) -->
            <button class="header-btn header-btn-settings" id="settings-btn" title="ConfiguraciÃ³n visual">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>
            </button>

            <!-- Notifications (bell SVG) -->
            <button class="header-btn" id="notifications-btn" title="Notificaciones">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                <span class="badge">3</span>
            </button>

            <!-- User Menu -->
            <div class="header-user" id="user-menu">
                <div class="header-user-avatar" id="header-avatar">DR</div>
                <div class="header-user-info">
                    <span class="header-user-name" id="header-username">Usuario</span>
                    <span class="header-user-role" id="header-role">Administrador</span>
                </div>
                <span class="dropdown-arrow">â–¼</span>

                <div class="header-dropdown">
                    <a href="/home" class="dropdown-item">ğŸ  Dashboard</a>
                    <a href="/productos" class="dropdown-item">ğŸ“¦ Productos</a>
                    <a href="/reports" class="dropdown-item">ğŸ“Š Reportes</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item dropdown-item-danger" onclick="logout()">ğŸšª Cerrar SesiÃ³n</a>
                </div>
            </div>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SETTINGS PANEL V2 (Lateral)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="settings-overlay" id="settings-overlay"></div>
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <span class="settings-title">Preferencias</span>
            <button class="modal-close" id="settings-close">Ã—</button>
        </div>
        <div class="settings-body">
            <!-- Esquema de colores -->
            <div class="settings-section">
                <div class="settings-section-title">Esquema de Colores</div>
                <div class="color-schemes">
                    <button class="color-scheme-btn color-scheme-moderno active"
                            onclick="Settings.setColorScheme('moderno')"
                            title="Moderno (Azul/Verde)"></button>
                    <button class="color-scheme-btn color-scheme-calido"
                            onclick="Settings.setColorScheme('calido')"
                            title="CÃ¡lido (Naranja/Rojo)"></button>
                    <button class="color-scheme-btn color-scheme-elegante"
                            onclick="Settings.setColorScheme('elegante')"
                            title="Elegante (PÃºrpura/Rosa)"></button>
                </div>
            </div>
            <!-- TamaÃ±o de texto -->
            <div class="settings-section">
                <div class="settings-section-title">TamaÃ±o de Texto</div>
                <div class="font-size-btns">
                    <button class="font-size-btn active" onclick="Settings.setFontSize('small')">PequeÃ±o</button>
                    <button class="font-size-btn" onclick="Settings.setFontSize('medium')">Mediano</button>
                    <button class="font-size-btn" onclick="Settings.setFontSize('large')">Grande</button>
                </div>
            </div>
            <!-- PosiciÃ³n de notificaciones -->
            <div class="settings-section">
                <div class="settings-section-title">PosiciÃ³n de Notificaciones</div>
                <div class="toast-position-grid">
                    <button class="toast-pos-btn active" onclick="Settings.setToastPosition('top-right')">â†—ï¸ Arr-Der</button>
                    <button class="toast-pos-btn" onclick="Settings.setToastPosition('top-center')">â¬†ï¸ Arr-Centro</button>
                    <button class="toast-pos-btn" onclick="Settings.setToastPosition('bottom-right')">â†˜ï¸ Abj-Der</button>
                    <button class="toast-pos-btn" onclick="Settings.setToastPosition('bottom-center')">â¬‡ï¸ Abj-Centro</button>
                </div>
            </div>
            <!-- Tema -->
            <div class="settings-section">
                <div class="settings-section-title">Tema</div>
                <div class="settings-option">
                    <span class="settings-option-label">Modo oscuro</span>
                    <label class="form-check" style="margin: 0;">
                        <input type="checkbox" id="dark-mode-toggle" onchange="Settings.toggleDarkMode()">
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MAIN CONTENT - PRODUCTOS
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="main-content">

        <!-- â”€â”€ Stats Bar â”€â”€ -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-card active" data-filter="all">
                <span class="stat-value" id="statTotal">-</span>
                <span class="stat-label">Total</span>
            </div>
            <div class="stat-card stat-active" data-filter="active">
                <span class="stat-value" id="statActive">-</span>
                <span class="stat-label">Activos</span>
            </div>
            <div class="stat-card stat-low" data-filter="low">
                <span class="stat-value" id="statLow">-</span>
                <span class="stat-label">Stock bajo</span>
            </div>
            <div class="stat-card stat-out" data-filter="out">
                <span class="stat-value" id="statOut">-</span>
                <span class="stat-label">Agotados</span>
            </div>
        </div>

        <!-- â”€â”€ Inventory Value â”€â”€ -->
        <div class="inventory-summary" id="inventorySummary">
            <div class="inv-item">
                <span class="inv-label">Valor inventario</span>
                <span class="inv-value" id="invValue">S/ -</span>
            </div>
            <div class="inv-sep"></div>
            <div class="inv-item">
                <span class="inv-label">Ganancia est.</span>
                <span class="inv-value inv-profit" id="invProfit">S/ -</span>
            </div>
        </div>

        <!-- â”€â”€ Search & Filters â”€â”€ -->
        <div class="filters-bar">
            <div class="search-wrap">
                <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18"><circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5L21 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar producto o alias..." autocomplete="off">
                <button class="search-clear" id="searchClear" title="Limpiar">&times;</button>
            </div>
            <div class="filter-row">
                <select id="filterCategory" class="filter-select">
                    <option value="">Todas las categorÃ­as</option>
                </select>
                <select id="filterStock" class="filter-select">
                    <option value="">Todo stock</option>
                    <option value="normal">Normal</option>
                    <option value="low">Stock bajo</option>
                    <option value="out">Agotado</option>
                </select>
                <select id="sortBy" class="filter-select">
                    <option value="name-asc">A â†’ Z</option>
                    <option value="name-desc">Z â†’ A</option>
                    <option value="sale_price-desc">Precio â†“</option>
                    <option value="sale_price-asc">Precio â†‘</option>
                    <option value="stock-asc">Menos stock</option>
                    <option value="stock-desc">MÃ¡s stock</option>
                </select>
            </div>
        </div>

        <!-- â”€â”€ Products Grid â”€â”€ -->
        <div class="products-container" id="productsContainer">
            <!-- Filled by JS -->
        </div>

        <!-- â”€â”€ Pagination (moved outside main for fixed positioning) â”€â”€ -->

        <!-- â”€â”€ Empty State â”€â”€ -->
        <div class="empty-state" id="emptyState" style="display:none;">
            <div class="empty-icon">ğŸ“¦</div>
            <div class="empty-title">No hay productos</div>
            <div class="empty-text">Importa un catÃ¡logo o agrega productos manualmente</div>
            <button class="btn btn-primary" onclick="ProductsApp.openImportModal()">Importar catÃ¡logo</button>
        </div>

    </main>

    <!-- â•â•â• Pagination (fixed bottom bar) â•â•â• -->
    <div class="pagination" id="pagination"></div>

    <!-- â•â•â• FAB (Floating Action Button) â•â•â• -->
    <div class="fab-container" id="fabContainer">
        <button class="fab-main" id="fabMain" title="Acciones">
            <svg viewBox="0 0 24 24" width="28" height="28"><path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>
        </button>
        <div class="fab-menu" id="fabMenu">
            <button class="fab-option" onclick="ProductsApp.openCreateModal()">
                <span class="fab-option-icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg></span>
                <span class="fab-option-label">Nuevo producto</span>
            </button>
            <button class="fab-option" onclick="ProductsApp.openImportModal()">
                <span class="fab-option-icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></span>
                <span class="fab-option-label">Importar catÃ¡logo</span>
            </button>
        </div>
    </div>

    <!-- â•â•â• MODAL: Crear/Editar Producto â•â•â• -->
    <div class="modal-overlay" id="modalProduct">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modalProductTitle">Nuevo producto</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalProduct')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProduct" onsubmit="return false;">
                    <input type="hidden" id="prodId">

                    <!-- Tab nav -->
                    <div class="tabs">
                        <button type="button" class="tab active" data-tab="tabBasic">BÃ¡sico</button>
                        <button type="button" class="tab" data-tab="tabExtras">Extras</button>
                        <button type="button" class="tab" data-tab="tabMayoreo">Mayoreo</button>
                    </div>

                    <!-- Tab: BÃ¡sico -->
                    <div class="tab-panel active" id="tabBasic">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="prodName" required maxlength="200" placeholder="Ej: Coca Cola 500ml">
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Precio venta *</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodPrice" required min="0.01" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Costo</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodCost" min="0" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Stock</label>
                                <input type="number" id="prodStock" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Stock mÃ­nimo</label>
                                <input type="number" id="prodMinStock" min="0" value="5">
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>CategorÃ­a</label>
                                <input type="text" id="prodCategory" list="categoryList" placeholder="Bebidas, Abarrotes...">
                                <datalist id="categoryList"></datalist>
                            </div>
                            <div class="form-group">
                                <label>Unidad</label>
                                <select id="prodUnit">
                                    <option value="UND">Unidad</option>
                                    <option value="KG">Kilogramo</option>
                                    <option value="LT">Litro</option>
                                    <option value="DOC">Docena</option>
                                    <option value="PAQ">Paquete</option>
                                    <option value="CJ">Caja</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Marca</label>
                            <input type="text" id="prodBrand" placeholder="Ej: Gloria, Alicorp...">
                        </div>
                        <div class="form-group">
                            <label>CÃ³digo de barras</label>
                            <input type="text" id="prodBarcode" placeholder="Escanear o escribir">
                        </div>
                    </div>

                    <!-- Tab: Extras -->
                    <div class="tab-panel" id="tabExtras">
                        <div class="form-group">
                            <label>Aliases (para voz y bÃºsqueda)</label>
                            <div class="chips-input" id="aliasesChips">
                                <div class="chips-list" id="aliasesList"></div>
                                <input type="text" id="aliasInput" placeholder="Escribe y presiona Enter" class="chip-input-field">
                            </div>
                            <small class="form-hint">Nombres alternativos: "coca", "gaseosa roja", "tarro"</small>
                        </div>
                        <div class="form-group">
                            <label>Tags</label>
                            <div class="chips-input" id="tagsChips">
                                <div class="chips-list" id="tagsList"></div>
                                <input type="text" id="tagInput" placeholder="Escribe y presiona Enter" class="chip-input-field">
                            </div>
                            <small class="form-hint">AgrupaciÃ³n: "alta_rotacion", "lonchera", "verano"</small>
                        </div>
                        <div class="form-group">
                            <label>DescripciÃ³n</label>
                            <textarea id="prodDescription" rows="2" placeholder="Opcional"></textarea>
                        </div>
                    </div>

                    <!-- Tab: Mayoreo -->
                    <div class="tab-panel" id="tabMayoreo">
                        <div class="mayoreo-info">
                            <p>Configura precios especiales por cantidad. Si el cliente compra mÃ¡s de la cantidad mÃ­nima, se aplica el precio de mayoreo.</p>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Cantidad mÃ­nima</label>
                                <input type="number" id="prodMayoreoQty" min="2" placeholder="Ej: 6">
                            </div>
                            <div class="form-group">
                                <label>Precio mayoreo</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodMayoreoPrice" min="0.01" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nota</label>
                            <input type="text" id="prodMayoreoNote" maxlength="100" placeholder="Ej: Pack 6 unidades, Caja 12 botellas">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalProduct')">Cancelar</button>
                <button class="btn btn-primary" id="btnSaveProduct" onclick="ProductsApp.saveProduct()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- â•â•â• MODAL: Importar CatÃ¡logo â•â•â• -->
    <div class="modal-overlay" id="modalImport">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Importar catÃ¡logo</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalImport')">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle">Selecciona catÃ¡logos para cargar productos con precios sugeridos, aliases y datos inteligentes.</p>
                <div class="catalogs-grid" id="catalogsGrid"></div>
                <div class="import-preview" id="importPreview" style="display:none;">
                    <div class="preview-header">
                        <h4 id="previewTitle">-</h4>
                        <span class="preview-count" id="previewCount">0 productos</span>
                    </div>
                    <div class="preview-categories" id="previewCategories"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalImport')">Cancelar</button>
                <button class="btn btn-primary" id="btnImport" onclick="ProductsApp.importCatalog()" disabled>Importar seleccionados</button>
            </div>
        </div>
    </div>

    <!-- â•â•â• MODAL: Ajustar Stock â•â•â• -->
    <div class="modal-overlay" id="modalStock">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Ajustar stock</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalStock')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-product-name" id="stockProductName">-</div>
                <div class="stock-current">Stock actual: <strong id="stockCurrent">0</strong></div>
                <input type="hidden" id="stockProductId">
                <div class="stock-controls">
                    <button class="stock-btn stock-minus" onclick="ProductsApp.adjustStockInput(-1)">âˆ’</button>
                    <input type="number" id="stockQty" value="0" class="stock-qty-input">
                    <button class="stock-btn stock-plus" onclick="ProductsApp.adjustStockInput(1)">+</button>
                </div>
                <div class="stock-presets">
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(-1)">-1</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(-5)">-5</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(5)">+5</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(10)">+10</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(24)">+24</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(48)">+48</button>
                </div>
                <div class="form-group" style="margin-top:12px;">
                    <label>Motivo</label>
                    <select id="stockReason">
                        <option value="Compra proveedor">Compra proveedor</option>
                        <option value="Ajuste inventario">Ajuste inventario</option>
                        <option value="Merma">Merma</option>
                        <option value="DevoluciÃ³n">DevoluciÃ³n</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalStock')">Cancelar</button>
                <button class="btn btn-primary" onclick="ProductsApp.saveStock()">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- â•â•â• MODAL: Cambio rÃ¡pido de precio â•â•â• -->
    <div class="modal-overlay" id="modalPrice">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Cambiar precio</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalPrice')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-product-name" id="priceProductName">-</div>
                <div class="stock-current">Precio actual: <strong id="priceCurrent">S/ 0</strong></div>
                <input type="hidden" id="priceProductId">
                <div class="form-group">
                    <label>Nuevo precio de venta</label>
                    <div class="input-prefix input-large">
                        <span>S/</span>
                        <input type="number" id="priceNew" min="0.01" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Nuevo costo (opcional)</label>
                    <div class="input-prefix">
                        <span>S/</span>
                        <input type="number" id="priceCostNew" min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalPrice')">Cancelar</button>
                <button class="btn btn-primary" onclick="ProductsApp.savePrice()">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- â•â•â• Toast Container V2 â•â•â• -->
    <div id="toast-container" class="toast-container toast-top-right"></div>

    <!-- â•â•â• Loader V2 (Con icono por nicho) â•â•â• -->
    <div class="loader-overlay" id="loader-overlay">
        <div class="loader-icon" id="loader-icon">ğŸ›’</div>
        <div class="loader-text">Cargando...</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         JAVASCRIPT
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- V2 Base: Settings + UserMenu + Toast + Modal + Loader (inline, del base_visual_completo) -->
    <script>
    /* â•â•â• SETTINGS â•â•â• */
    const Settings = {
        defaults: { theme: 'light', colorScheme: 'moderno', fontSize: 'small', toastPosition: 'top-right' },

        init() {
            const saved = JSON.parse(localStorage.getItem('userSettings') || '{}');
            const config = { ...this.defaults, ...saved };
            this.setTheme(config.theme, false);
            this.setColorScheme(config.colorScheme, false);
            this.setFontSize(config.fontSize, false);
            this.setToastPosition(config.toastPosition, false);
            document.getElementById('dark-mode-toggle').checked = config.theme === 'dark';
            document.getElementById('settings-btn').addEventListener('click', () => this.openPanel());
            document.getElementById('settings-close').addEventListener('click', () => this.closePanel());
            document.getElementById('settings-overlay').addEventListener('click', () => this.closePanel());
            document.getElementById('theme-toggle').addEventListener('click', () => this.toggleDarkMode());
        },

        save() {
            const config = {
                theme: document.documentElement.getAttribute('data-theme'),
                colorScheme: document.documentElement.getAttribute('data-color-scheme'),
                fontSize: document.documentElement.getAttribute('data-font-size'),
                toastPosition: Toast.config.position
            };
            localStorage.setItem('userSettings', JSON.stringify(config));
        },

        openPanel() {
            document.getElementById('settings-panel').classList.add('active');
            document.getElementById('settings-overlay').classList.add('active');
        },

        closePanel() {
            document.getElementById('settings-panel').classList.remove('active');
            document.getElementById('settings-overlay').classList.remove('active');
        },

        setTheme(theme, showToast = true) {
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('dark-mode-toggle').checked = theme === 'dark';
            this.save();
            if (showToast) Toast.info(theme === 'dark' ? 'Modo oscuro' : 'Modo claro');
        },

        toggleDarkMode() {
            const current = document.documentElement.getAttribute('data-theme');
            this.setTheme(current === 'dark' ? 'light' : 'dark');
        },

        setColorScheme(scheme, showToast = true) {
            document.documentElement.setAttribute('data-color-scheme', scheme);
            document.querySelectorAll('.color-scheme-btn').forEach(btn => btn.classList.remove('active'));
            const btn = document.querySelector(`.color-scheme-${scheme}`);
            if (btn) btn.classList.add('active');
            this.save();
            const names = { moderno: 'Moderno', calido: 'CÃ¡lido', elegante: 'Elegante' };
            if (showToast) Toast.info(`Tema ${names[scheme]}`);
        },

        setFontSize(size, showToast = true) {
            document.documentElement.setAttribute('data-font-size', size);
            document.querySelectorAll('.font-size-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.font-size-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(size === 'small' ? 'pequeÃ±o' : size === 'medium' ? 'mediano' : 'grande')) {
                    btn.classList.add('active');
                }
            });
            this.save();
            const names = { small: 'PequeÃ±o', medium: 'Mediano', large: 'Grande' };
            if (showToast) Toast.info(`Texto ${names[size]}`);
        },

        setToastPosition(position, showToast = true) {
            Toast.setPosition(position);
            document.querySelectorAll('.toast-pos-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.toast-pos-btn').forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(position)) {
                    btn.classList.add('active');
                }
            });
            this.save();
            const names = { 'top-right': 'Arriba derecha', 'top-center': 'Arriba centro', 'bottom-right': 'Abajo derecha', 'bottom-center': 'Abajo centro' };
            if (showToast) Toast.info(`Notificaciones: ${names[position]}`);
        }
    };

    /* â•â•â• USER MENU â•â•â• */
    const UserMenu = {
        init() {
            const menu = document.getElementById('user-menu');
            menu.addEventListener('click', (e) => {
                e.stopPropagation();
                menu.classList.toggle('active');
            });
            document.addEventListener('click', () => menu.classList.remove('active'));
        }
    };

    /* â•â•â• TOAST V2 â•â•â• */
    const Toast = {
        container: null,
        config: { position: 'top-right', duration: 3500, maxToasts: 4 },

        init() {
            this.container = document.getElementById('toast-container');
        },

        show(message, type = 'info', title = '') {
            const existing = this.container.querySelectorAll('.toast');
            if (existing.length >= this.config.maxToasts) existing[0].remove();

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = { success: 'âœ“', error: 'âœ•', warning: 'âš ', info: 'â„¹' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <div class="toast-content">
                    ${title ? `<div class="toast-title">${title}</div>` : ''}
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="Toast.dismiss(this.parentElement)">Ã—</button>
            `;

            if (this.config.position.includes('bottom')) {
                this.container.prepend(toast);
            } else {
                this.container.appendChild(toast);
            }

            requestAnimationFrame(() => toast.classList.add('toast-show'));
            if (this.config.duration > 0) {
                setTimeout(() => this.dismiss(toast), this.config.duration);
            }
            return toast;
        },

        dismiss(toast) {
            if (!toast || !toast.parentElement) return;
            toast.classList.remove('toast-show');
            toast.classList.add('toast-hide');
            setTimeout(() => toast.remove(), 300);
        },

        setPosition(position) {
            this.config.position = position;
            this.container.className = `toast-container toast-${position}`;
        },

        success(msg, title = '') { return this.show(msg, 'success', title); },
        error(msg, title = '') { return this.show(msg, 'error', title); },
        warning(msg, title = '') { return this.show(msg, 'warning', title); },
        info(msg, title = '') { return this.show(msg, 'info', title); }
    };

    /* â•â•â• MODAL V2 â•â•â• */
    const Modal = {
        open(id) {
            const modal = document.getElementById(id);
            if (modal) { modal.classList.add('active'); document.body.style.overflow = 'hidden'; }
        },
        close(id) {
            const modal = document.getElementById(id);
            if (modal) { modal.classList.remove('active'); document.body.style.overflow = ''; }
        }
    };

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
            Settings.closePanel();
            document.body.style.overflow = '';
        }
    });

    /* â•â•â• LOADER V2 â•â•â• */
    const Loader = {
        icons: { bodega: 'ğŸ›’', minimarket: 'ğŸ›’', restaurante: 'ğŸ½ï¸', cafeteria: 'â˜•', farmacia: 'ğŸ’Š', ferreteria: 'ğŸ”§', libreria: 'ğŸ“š', default: 'â³' },
        show(nicho = 'bodega') {
            const icon = this.icons[nicho] || this.icons.default;
            document.getElementById('loader-icon').textContent = icon;
            document.getElementById('loader-overlay').classList.add('active');
        },
        hide() {
            document.getElementById('loader-overlay').classList.remove('active');
        }
    };

    /* â•â•â• HEADER USER DATA â•â•â• */
    function loadHeaderUser() {
        const token = localStorage.getItem('token');
        if (!token) return;
        fetch('/api/v1/users/me', { headers: { 'Authorization': `Bearer ${token}` } })
            .then(r => r.json())
            .then(user => {
                if (user && user.name) {
                    const initials = user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                    document.getElementById('header-avatar').textContent = initials;
                    document.getElementById('header-username').textContent = user.name;
                    document.getElementById('header-role').textContent = user.role === 'owner' ? 'Administrador' : 'Vendedor';
                }
            })
            .catch(() => {});
    }

    function logout() {
        localStorage.removeItem('token');
        window.location.href = '/auth/login';
    }

    /* â•â•â• INIT V2 BASE â•â•â• */
    document.addEventListener('DOMContentLoaded', () => {
        Toast.init();
        UserMenu.init();
        Settings.init();
        loadHeaderUser();
    });
    </script>

    <!-- Module: Products App -->
    <script src="/static/js/products/products.js?v=20260224c"></script>
</body>
</html>