<!DOCTYPE html>
<html lang="es" data-theme="light" data-color="gold">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Productos - QueVendi PRO</title>

    <!-- Base V2 -->
    <link rel="stylesheet" href="/static/css/base/layout.css?v=20260223c">
    <link rel="stylesheet" href="/static/css/base/header.css?v=20260223c">
    <link rel="stylesheet" href="/static/css/base/toast.css?v=20260223c">
    <link rel="stylesheet" href="/static/css/base/modal.css?v=20260223c">
    <link rel="stylesheet" href="/static/css/base/loader.css?v=20260223c">

    <!-- Module -->
    <link rel="stylesheet" href="/static/css/products/products.css?v=20260223c">
</head>
<body>

    <!-- ‚ïê‚ïê‚ïê HEADER (V2 base) ‚ïê‚ïê‚ïê -->
    <div id="header-container"></div>

    <!-- ‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê -->
    <main class="main-content">

        <!-- ‚îÄ‚îÄ Stats Bar ‚îÄ‚îÄ -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-card" data-filter="all">
                <span class="stat-value" id="statTotal">-</span>
                <span class="stat-label">Total</span>
            </div>
            <div class="stat-card stat-active" data-filter="active">
                <span class="stat-value" id="statActive">-</span>
                <span class="stat-label">Activos</span>
            </div>
            <div class="stat-card stat-low" data-filter="low">
                <span class="stat-value" id="statLow">-</span>
                <span class="stat-label">Stock bajo</span>
            </div>
            <div class="stat-card stat-out" data-filter="out">
                <span class="stat-value" id="statOut">-</span>
                <span class="stat-label">Agotados</span>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Inventory Value ‚îÄ‚îÄ -->
        <div class="inventory-summary" id="inventorySummary">
            <div class="inv-item">
                <span class="inv-label">Valor inventario</span>
                <span class="inv-value" id="invValue">S/ -</span>
            </div>
            <div class="inv-sep"></div>
            <div class="inv-item">
                <span class="inv-label">Ganancia est.</span>
                <span class="inv-value inv-profit" id="invProfit">S/ -</span>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Search & Filters ‚îÄ‚îÄ -->
        <div class="filters-bar">
            <div class="search-wrap">
                <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18"><circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16.5 16.5L21 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar producto o alias..." autocomplete="off">
                <button class="search-clear" id="searchClear" title="Limpiar">&times;</button>
            </div>
            <div class="filter-row">
                <select id="filterCategory" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                </select>
                <select id="filterStock" class="filter-select">
                    <option value="">Todo stock</option>
                    <option value="normal">Normal</option>
                    <option value="low">Stock bajo</option>
                    <option value="out">Agotado</option>
                </select>
                <select id="sortBy" class="filter-select">
                    <option value="name-asc">A ‚Üí Z</option>
                    <option value="name-desc">Z ‚Üí A</option>
                    <option value="sale_price-desc">Precio ‚Üì</option>
                    <option value="sale_price-asc">Precio ‚Üë</option>
                    <option value="stock-asc">Menos stock</option>
                    <option value="stock-desc">M√°s stock</option>
                </select>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Products Grid ‚îÄ‚îÄ -->
        <div class="products-container" id="productsContainer">
            <!-- Filled by JS -->
        </div>

        <!-- ‚îÄ‚îÄ Pagination ‚îÄ‚îÄ -->
        <div class="pagination" id="pagination"></div>

        <!-- ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ -->
        <div class="empty-state" id="emptyState" style="display:none;">
            <div class="empty-icon">üì¶</div>
            <div class="empty-title">No hay productos</div>
            <div class="empty-text">Importa un cat√°logo o agrega productos manualmente</div>
            <button class="btn btn-primary" onclick="ProductsApp.openImportModal()">Importar cat√°logo</button>
        </div>

    </main>

    <!-- ‚ïê‚ïê‚ïê FAB (Floating Action Button) ‚ïê‚ïê‚ïê -->
    <div class="fab-container" id="fabContainer">
        <button class="fab-main" id="fabMain" title="Acciones">
            <svg viewBox="0 0 24 24" width="28" height="28"><path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>
        </button>
        <div class="fab-menu" id="fabMenu">
            <button class="fab-option" onclick="ProductsApp.openCreateModal()">
                <span class="fab-option-icon">‚úèÔ∏è</span>
                <span class="fab-option-label">Nuevo producto</span>
            </button>
            <button class="fab-option" onclick="ProductsApp.openImportModal()">
                <span class="fab-option-icon">üì•</span>
                <span class="fab-option-label">Importar cat√°logo</span>
            </button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Crear/Editar Producto ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalProduct">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modalProductTitle">Nuevo producto</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalProduct')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProduct" onsubmit="return false;">
                    <input type="hidden" id="prodId">

                    <!-- Tab nav -->
                    <div class="tabs">
                        <button type="button" class="tab active" data-tab="tabBasic">B√°sico</button>
                        <button type="button" class="tab" data-tab="tabExtras">Extras</button>
                        <button type="button" class="tab" data-tab="tabMayoreo">Mayoreo</button>
                    </div>

                    <!-- Tab: B√°sico -->
                    <div class="tab-panel active" id="tabBasic">
                        <div class="form-group">
                            <label>Nombre *</label>
                            <input type="text" id="prodName" required maxlength="200" placeholder="Ej: Coca Cola 500ml">
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Precio venta *</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodPrice" required min="0.01" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Costo</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodCost" min="0" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Stock</label>
                                <input type="number" id="prodStock" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Stock m√≠nimo</label>
                                <input type="number" id="prodMinStock" min="0" value="5">
                            </div>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Categor√≠a</label>
                                <input type="text" id="prodCategory" list="categoryList" placeholder="Bebidas, Abarrotes...">
                                <datalist id="categoryList"></datalist>
                            </div>
                            <div class="form-group">
                                <label>Unidad</label>
                                <select id="prodUnit">
                                    <option value="UND">Unidad</option>
                                    <option value="KG">Kilogramo</option>
                                    <option value="LT">Litro</option>
                                    <option value="DOC">Docena</option>
                                    <option value="PAQ">Paquete</option>
                                    <option value="CJ">Caja</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Marca</label>
                            <input type="text" id="prodBrand" placeholder="Ej: Gloria, Alicorp...">
                        </div>
                        <div class="form-group">
                            <label>C√≥digo de barras</label>
                            <input type="text" id="prodBarcode" placeholder="Escanear o escribir">
                        </div>
                    </div>

                    <!-- Tab: Extras -->
                    <div class="tab-panel" id="tabExtras">
                        <div class="form-group">
                            <label>Aliases (para voz y b√∫squeda)</label>
                            <div class="chips-input" id="aliasesChips">
                                <div class="chips-list" id="aliasesList"></div>
                                <input type="text" id="aliasInput" placeholder="Escribe y presiona Enter" class="chip-input-field">
                            </div>
                            <small class="form-hint">Nombres alternativos: "coca", "gaseosa roja", "tarro"</small>
                        </div>
                        <div class="form-group">
                            <label>Tags</label>
                            <div class="chips-input" id="tagsChips">
                                <div class="chips-list" id="tagsList"></div>
                                <input type="text" id="tagInput" placeholder="Escribe y presiona Enter" class="chip-input-field">
                            </div>
                            <small class="form-hint">Agrupaci√≥n: "alta_rotacion", "lonchera", "verano"</small>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="prodDescription" rows="2" placeholder="Opcional"></textarea>
                        </div>
                    </div>

                    <!-- Tab: Mayoreo -->
                    <div class="tab-panel" id="tabMayoreo">
                        <div class="mayoreo-info">
                            <p>Configura precios especiales por cantidad. Si el cliente compra m√°s de la cantidad m√≠nima, se aplica el precio de mayoreo.</p>
                        </div>
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>Cantidad m√≠nima</label>
                                <input type="number" id="prodMayoreoQty" min="2" placeholder="Ej: 6">
                            </div>
                            <div class="form-group">
                                <label>Precio mayoreo</label>
                                <div class="input-prefix">
                                    <span>S/</span>
                                    <input type="number" id="prodMayoreoPrice" min="0.01" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nota</label>
                            <input type="text" id="prodMayoreoNote" maxlength="100" placeholder="Ej: Pack 6 unidades, Caja 12 botellas">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalProduct')">Cancelar</button>
                <button class="btn btn-primary" id="btnSaveProduct" onclick="ProductsApp.saveProduct()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Importar Cat√°logo ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalImport">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Importar cat√°logo</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalImport')">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle">Selecciona cat√°logos para cargar productos con precios sugeridos, aliases y datos inteligentes.</p>
                <div class="catalogs-grid" id="catalogsGrid">
                    <!-- Filled by JS -->
                </div>
                <div class="import-preview" id="importPreview" style="display:none;">
                    <div class="preview-header">
                        <h4 id="previewTitle">-</h4>
                        <span class="preview-count" id="previewCount">0 productos</span>
                    </div>
                    <div class="preview-categories" id="previewCategories"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalImport')">Cancelar</button>
                <button class="btn btn-primary" id="btnImport" onclick="ProductsApp.importCatalog()" disabled>Importar seleccionados</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Ajustar Stock ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalStock">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Ajustar stock</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalStock')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-product-name" id="stockProductName">-</div>
                <div class="stock-current">Stock actual: <strong id="stockCurrent">0</strong></div>
                <input type="hidden" id="stockProductId">
                <div class="stock-controls">
                    <button class="stock-btn stock-minus" onclick="ProductsApp.adjustStockInput(-1)">‚àí</button>
                    <input type="number" id="stockQty" value="0" class="stock-qty-input">
                    <button class="stock-btn stock-plus" onclick="ProductsApp.adjustStockInput(1)">+</button>
                </div>
                <div class="stock-presets">
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(-1)">-1</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(-5)">-5</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(5)">+5</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(10)">+10</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(24)">+24</button>
                    <button class="preset-btn" onclick="ProductsApp.setStockQty(48)">+48</button>
                </div>
                <div class="form-group" style="margin-top:12px;">
                    <label>Motivo</label>
                    <select id="stockReason">
                        <option value="Compra proveedor">Compra proveedor</option>
                        <option value="Ajuste inventario">Ajuste inventario</option>
                        <option value="Merma">Merma</option>
                        <option value="Devoluci√≥n">Devoluci√≥n</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalStock')">Cancelar</button>
                <button class="btn btn-primary" onclick="ProductsApp.saveStock()">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê MODAL: Cambio r√°pido de precio ‚ïê‚ïê‚ïê -->
    <div class="modal-overlay" id="modalPrice">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Cambiar precio</h3>
                <button class="modal-close" onclick="ProductsApp.closeModal('modalPrice')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stock-product-name" id="priceProductName">-</div>
                <div class="stock-current">Precio actual: <strong id="priceCurrent">S/ 0</strong></div>
                <input type="hidden" id="priceProductId">
                <div class="form-group">
                    <label>Nuevo precio de venta</label>
                    <div class="input-prefix input-large">
                        <span>S/</span>
                        <input type="number" id="priceNew" min="0.01" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Nuevo costo (opcional)</label>
                    <div class="input-prefix">
                        <span>S/</span>
                        <input type="number" id="priceCostNew" min="0" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="ProductsApp.closeModal('modalPrice')">Cancelar</button>
                <button class="btn btn-primary" onclick="ProductsApp.savePrice()">Actualizar</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê Loader ‚ïê‚ïê‚ïê -->
    <div id="loader" class="loader-overlay" style="display:none;">
        <div class="loader-spinner"></div>
    </div>

    <!-- Base V2 JS -->
    <script src="/static/js/base/layout.js"></script>
    <script src="/static/js/base/header.js"></script>
    <script src="/static/js/base/toast.js"></script>
    <script src="/static/js/base/modal.js"></script>
    <script src="/static/js/base/loader.js"></script>

    <!-- Module -->
    <script src="/static/js/products/products.js?v=20260223c"></script>
</body>
</html>