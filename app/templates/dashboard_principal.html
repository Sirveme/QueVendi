<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f0f23">
    <title>QueVendi - Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/dashboard_principal.css">
    
    <!-- PWA -->
    <link rel="manifest" href="/static/manifest.json">

    <style>
        .fiado-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 10005;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
            /* SIN opacity:0 ni visibility:hidden ‚Äî se controla solo con display */
        }

    .payment-methods {
        display: flex;
        gap: 6px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 4px;
        scrollbar-width: none;          /* Firefox */
    }
    .payment-methods::-webkit-scrollbar {
        display: none;                  /* Chrome/Safari */
    }
    .payment-btn {
        flex-shrink: 0;
        white-space: nowrap;
        font-size: 12px;
    }
    </style>
</head>
<body>
    <!-- ========================================
         MEN√ö LATERAL (SLIDE)
    ======================================== -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-user">
                <div class="sidebar-avatar" id="sidebar-avatar">U</div>
                <div class="sidebar-user-info">
                    <span class="sidebar-username" id="sidebar-username">Usuario</span>
                    <span class="sidebar-store" id="sidebar-store">Mi Bodega</span>
                </div>
            </div>
            <button class="sidebar-close" onclick="toggleSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Categor√≠as con slider horizontal -->
        <div class="sidebar-categories">
            <button class="category-tab active" data-category="gerente">
                <i class="fas fa-robot"></i> Gerente IA
            </button>
            <button class="category-tab" data-category="operativa">
                <i class="fas fa-boxes"></i> Operativa
            </button>
            <button class="category-tab" data-category="financiera">
                <i class="fas fa-chart-line"></i> Financiera
            </button>
            <button class="category-tab" data-category="comercial">
                <i class="fas fa-bullhorn"></i> Comercial
            </button>
            <button class="category-tab" data-category="seguridad">
                <i class="fas fa-shield-alt"></i> Seguridad
            </button>
            <button class="category-tab" data-category="config">
                <i class="fas fa-cog"></i> Config
            </button>
        </div>
        
        <!-- Contenido de cada categor√≠a -->
        <div class="sidebar-content">
            <!-- GERENTE IA -->
            <div class="category-content active" id="cat-gerente">
                <div class="gerente-chat">
                    <div class="chat-welcome">
                        <div class="chat-icon">ü§ñ</div>
                        <h3>¬øEn qu√© te ayudo?</h3>
                        <p>Preg√∫ntame sobre ventas, stock, clientes o cualquier cosa de tu negocio.</p>
                    </div>
                    <div class="chat-suggestions">
                        <button class="suggestion-chip" onclick="askGerente('¬øCu√°nto vend√≠ hoy?')">
                            üí∞ ¬øCu√°nto vend√≠ hoy?
                        </button>
                        <button class="suggestion-chip" onclick="askGerente('¬øQu√© producto me da m√°s margen?')">
                            üìä ¬øMejor margen?
                        </button>
                        <button class="suggestion-chip" onclick="askGerente('¬øQui√©n me debe m√°s?')">
                            üìù ¬øQui√©n me debe?
                        </button>
                        <button class="suggestion-chip" onclick="askGerente('¬øQu√© debo reponer?')">
                            üì¶ ¬øQu√© reponer?
                        </button>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="gerente-input" placeholder="Escribe tu pregunta...">
                        <button class="btn-mic-gerente" onclick="voiceAskGerente()">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="btn-send-gerente" onclick="sendGerenteQuestion()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- OPERATIVA -->
            <div class="category-content" id="cat-operativa">
                <nav class="sidebar-nav">
                    <a href="/productos" class="nav-item">
                        <i class="fas fa-boxes"></i>
                        <span>Stock actual</span>
                        <span class="nav-badge" id="total-products">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showLowStock()">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Stock bajo</span>
                        <span class="nav-badge warning" id="low-stock-count">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showExpiring()">
                        <i class="fas fa-clock"></i>
                        <span>Por vencer</span>
                        <span class="nav-badge danger" id="expiring-count">0</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showPurchaseForm()">
                        <i class="fas fa-truck"></i>
                        <span>Registrar compra</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showInventory()">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Inventario</span>
                    </a>
                </nav>
            </div>
            
            <!-- FINANCIERA -->
            <div class="category-content" id="cat-financiera">
                <nav class="sidebar-nav">
                    <a href="/reports" class="nav-item">
                        <i class="fas fa-chart-bar"></i>
                        <span>Ventas del d√≠a</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showProfits()">
                        <i class="fas fa-coins"></i>
                        <span>Ganancias y m√°rgenes</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showFiados()">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>Fiados pendientes</span>
                        <span class="nav-badge warning" id="fiados-count">0</span>
                    </a>
                    <a href="#" class="nav-item owner-only" onclick="showCashFlow()">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Flujo de caja</span>
                    </a>
                    <a href="#" class="nav-item owner-only" onclick="editDailyGoal()">
                        <i class="fas fa-bullseye"></i>
                        <span>Meta diaria</span>
                        <i class="fas fa-cog nav-config"></i>
                    </a>
                </nav>
            </div>
            
            <!-- COMERCIAL -->
            <div class="category-content" id="cat-comercial">
                <nav class="sidebar-nav">
                    <a href="#" class="nav-item" onclick="showTopProducts()">
                        <i class="fas fa-fire"></i>
                        <span>Top ventas</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSlowProducts()">
                        <i class="fas fa-snowflake"></i>
                        <span>Sin rotaci√≥n</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showComboSuggestions()">
                        <i class="fas fa-gift"></i>
                        <span>Sugerencias de combos</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showFrequentClients()">
                        <i class="fas fa-users"></i>
                        <span>Clientes frecuentes</span>
                    </a>
                    <a href="#" class="nav-item owner-only" onclick="showPromotions()">
                        <i class="fas fa-tags"></i>
                        <span>Promociones</span>
                    </a>
                </nav>
            </div>
            
            <!-- SEGURIDAD -->
            <div class="category-content" id="cat-seguridad">
                <nav class="sidebar-nav">
                    <a href="#" class="nav-item" onclick="showReportIncident()">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Reportar amenaza</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showMyReports()">
                        <i class="fas fa-file-alt"></i>
                        <span>Mis reportes</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showBodeguerosNetwork()">
                        <i class="fas fa-store-alt"></i>
                        <span>Red de bodegueros</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showEmergencyContacts()">
                        <i class="fas fa-phone-alt"></i>
                        <span>Contactos emergencia</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSecurityGuide()">
                        <i class="fas fa-book"></i>
                        <span>Gu√≠a antiextorsi√≥n</span>
                    </a>
                </nav>
            </div>
            
            <!-- CONFIGURACI√ìN -->
            <div class="category-content" id="cat-config">
                <nav class="sidebar-nav">
                    <a href="#" class="nav-item" onclick="showProfile()">
                        <i class="fas fa-user"></i>
                        <span>Mi perfil</span>
                    </a>
                    <a href="#" class="nav-item owner-only" onclick="showUsers()">
                        <i class="fas fa-users-cog"></i>
                        <span>Usuarios</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showVoiceConfig()">
                        <i class="fas fa-microphone-alt"></i>
                        <span>Config. voz</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showPrinterConfig()">
                        <i class="fas fa-print"></i>
                        <span>Impresora</span>
                    </a>
                    <a href="#" class="nav-item owner-only" onclick="showPlanBilling()">
                        <i class="fas fa-credit-card"></i>
                        <span>Plan y facturaci√≥n</span>
                    </a>
                    <a href="#" class="nav-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Cerrar sesi√≥n</span>
                    </a>
                </nav>
            </div>
        </div>
    </aside>
    
    <!-- Overlay para cerrar sidebar -->
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- ========================================
         CONTENIDO PRINCIPAL
    ======================================== -->
    <main class="main-content">
        <!-- HEADER -->
        <header class="header">
            <button class="btn-menu" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-info">
                <span class="header-username" id="header-username">Usuario</span>
                <span class="header-store" id="header-store">Mi Bodega</span>
            </div>

            <!-- En dashboard_principal.html, agregar en el header -->
            <button id="audio-toggle-btn" 
                    onclick="AudioAssistant.toggle()" 
                    class="audio-toggle-btn" 
                    title="Activar/desactivar anuncios de audio">
                <i class="fas fa-volume-up"></i>
            </button>

            <div class="header-actions">
                <button class="btn-header" id="btn-notifications" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-count" style="display:none;">0</span>
                </button>
            </div>
        </header>

        <!-- BUSCADOR -->
        <section class="search-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input 
                    type="text" 
                    id="search-input" 
                    class="search-input" 
                    placeholder="Buscar producto..."
                    autocomplete="off"
                    oninput="searchProducts(this.value)"
                >
                <div class="mic-buttons">
                    <button 
                        class="btn-mic" 
                        id="btn-mic-basic" 
                        onclick="startVoiceSearch('basic')"
                        title="Voz b√°sica (Plan B√°sico)"
                    >
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button 
                        class="btn-mic pro" 
                        id="btn-mic-pro" 
                        onclick="startVoiceSearch('pro')"
                        title="Voz PRO (Whisper)"
                    >
                        <i class="fas fa-microphone"></i>
                        <span class="pro-badge">PRO</span>
                    </button>
                </div>
            </div>
            <!-- Resultados de b√∫squeda -->
            <div id="search-results" class="search-results" style="display:none;"></div>
        </section>

        <!-- META DEL D√çA -->
        <section class="goal-section">
            <div class="goal-bar-container">
                <div class="goal-bar" id="goal-bar" style="width: 0%"></div>
            </div>
            <div class="goal-info">
                <span class="goal-text" id="goal-text">S/. 0 / S/. 500</span>
                <span class="goal-percent" id="goal-percent">0%</span>
            </div>
        </section>

        <!-- CARRITO -->
        <section class="cart-section">
            <div class="cart-header">
                <h2><i class="fas fa-shopping-cart"></i> Carrito</h2>
                <div class="cart-summary">
                    <span id="cart-count">0 items</span>
                    <button class="btn-clear-cart" onclick="clearCart()" title="Vaciar carrito">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="cart-items" id="cart-items">
                <div class="cart-empty" id="cart-empty">
                    <i class="fas fa-shopping-basket"></i>
                    <p>Carrito vac√≠o</p>
                    <span>Busca productos o usa el micr√≥fono</span>
                </div>
            </div>
            
            <!-- Sugerencias de venta cruzada (din√°mico v√≠a JS) -->
            <div class="cross-sell" id="cross-sell" style="display: none;">
                <span class="cross-sell-label">
                    <i class="fas fa-lightbulb"></i> Tambi√©n llevan:
                </span>
                <div class="cross-sell-items" id="cross-sell-items">
                    <!-- Se llena din√°micamente desde pos.js -->
                </div>
            </div>


            <!-- Frases promocionales del bodeguero -->
            <div class="bodeguero-phrase" id="bodeguero-phrase" style="display:none;">
                <div class="phrase-icon">üó£Ô∏è</div>
                <div class="phrase-text" id="phrase-text"></div>
            </div>
        </section>

        <!-- TOTAL Y PAGO -->
        <section class="checkout-section">
            <div class="total-row">
                <span class="total-label">TOTAL</span>
                <span class="total-amount" id="total-amount">S/. 0.00</span>
            </div>
            
            <div class="payment-methods" id="payment-methods">
                <button class="payment-btn active" data-method="efectivo" onclick="selectPayment('efectivo', event)">
                    <i class="fas fa-money-bill-wave"></i> Efectivo
                </button>
                <button class="payment-btn" data-method="yape" onclick="selectPayment('yape', event)">
                    <img src="/static/img/yape-icon.png" alt="Yape" onerror="this.outerHTML='<i class=\'fas fa-mobile-alt\'></i>'"> Yape
                </button>
                <button class="payment-btn" data-method="plin" onclick="selectPayment('plin', event)">
                    <img src="/static/img/plin-icon.png" alt="Plin" onerror="this.outerHTML='<i class=\'fas fa-mobile-alt\'></i>'"> Plin
                </button>
                <button class="payment-btn" data-method="tarjeta" onclick="selectPayment('tarjeta', event)">
                    <i class="fas fa-credit-card"></i> Tarjeta
                </button>
                <button class="payment-btn" data-method="fiado" onclick="selectPayment('fiado', event)">
                    <i class="fas fa-handshake"></i> Fiado
                </button>
            </div>
            
            <!-- Campo cliente para Fiado - VERSI√ìN COMPLETA -->
            <!-- Overlay oscuro flotante -->
            <div id="modal-fiado-overlay" class="fiado-overlay" style="display: none;">
                <div class="modal-fiado-container">
                    <div class="modal-fiado-header">
                        <h2>
                            <i class="fas fa-user-tag"></i>
                            Datos del Cliente - Fiado
                        </h2>
                        <button onclick="cerrarModalFiado()" class="btn-close-modal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="modal-fiado-body">
                        <!-- Informaci√≥n del cliente -->
                        <div class="form-section">
                            <h3><i class="fas fa-user"></i> Informaci√≥n Personal</h3>
                            
                            <div class="form-group">
                                <label for="modal-fiado-nombre">
                                    <i class="fas fa-user"></i> Nombre Completo *
                                </label>
                                <input 
                                    type="text" 
                                    id="modal-fiado-nombre" 
                                    placeholder="Ej: Juan P√©rez Garc√≠a"
                                    required
                                    autocomplete="off">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="modal-fiado-telefono">
                                        <i class="fas fa-phone"></i> Tel√©fono *
                                    </label>
                                    <input 
                                        type="tel" 
                                        id="modal-fiado-telefono" 
                                        placeholder="987654321"
                                        required
                                        maxlength="9">
                                </div>
                                
                                <div class="form-group">
                                    <label for="modal-fiado-dni">
                                        <i class="fas fa-id-card"></i> DNI
                                    </label>
                                    <input 
                                        type="text" 
                                        id="modal-fiado-dni" 
                                        placeholder="12345678"
                                        maxlength="8">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="modal-fiado-direccion">
                                    <i class="fas fa-map-marker-alt"></i> Direcci√≥n *
                                </label>
                                <input 
                                    type="text" 
                                    id="modal-fiado-direccion" 
                                    placeholder="Ej: Jr. Lima 123, Bre√±a"
                                    required>
                            </div>
                        </div>
                        
                        <!-- T√©rminos del cr√©dito -->
                        <div class="form-section">
                            <h3><i class="fas fa-calendar-alt"></i> T√©rminos del Cr√©dito</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="modal-fiado-dias">
                                        <i class="fas fa-clock"></i> D√≠as de Cr√©dito *
                                    </label>
                                    <select id="modal-fiado-dias" required>
                                        <option value="7">7 d√≠as (1 semana)</option>
                                        <option value="15">15 d√≠as (2 semanas)</option>
                                        <option value="30" selected>30 d√≠as (1 mes)</option>
                                        <option value="60">60 d√≠as (2 meses)</option>
                                        <option value="90">90 d√≠as (3 meses)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="modal-fiado-referencia">
                                        <i class="fas fa-hashtag"></i> N¬∞ Referencia
                                    </label>
                                    <input 
                                        type="text" 
                                        id="modal-fiado-referencia" 
                                        placeholder="Ej: FI-001"
                                        maxlength="20">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="modal-fiado-notas">
                                    <i class="fas fa-sticky-note"></i> Notas Adicionales
                                </label>
                                <textarea 
                                    id="modal-fiado-notas" 
                                    placeholder="Informaci√≥n adicional sobre el cr√©dito..."
                                    rows="3"
                                    maxlength="500"></textarea>
                            </div>
                        </div>
                        
                        <!-- Resumen -->
                        <div class="fiado-summary">
                            <div class="summary-row">
                                <span>Monto Total:</span>
                                <strong id="fiado-total-display">S/. 0.00</strong>
                            </div>
                            <div class="summary-row">
                                <span>Fecha de Vencimiento:</span>
                                <strong id="fiado-due-date">--/--/----</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-fiado-footer">
                        <button onclick="cerrarModalFiado()" class="btn-secondary">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                        <button onclick="confirmarDatosFiado()" class="btn-primary">
                            <i class="fas fa-check-circle"></i>
                            Confirmar Datos
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Bot√≥n COBRAR (visible cuando NO es fiado) -->
            <button class="btn-checkout" id="btn-checkout" onclick="processSale()">
                <i class="fas fa-cash-register"></i>
                <span>COBRAR</span>
            </button>
        </section>

        <!-- FOOTER -->
        <footer class="footer">
            <button class="footer-btn" onclick="showStock()">
                <i class="fas fa-boxes"></i>
                <span>Stock</span>
            </button>
            <button class="footer-btn" onclick="showSales()">
                <i class="fas fa-chart-bar"></i>
                <span>Ventas</span>
            </button>
            <button class="footer-btn" onclick="printLastTicket()">
                <i class="fas fa-print"></i>
                <span>Ticket</span>
            </button>
            <button class="footer-btn" onclick="toggleSidebar(); switchCategory('gerente');">
                <i class="fas fa-robot"></i>
                <span>Gerente</span>
            </button>
            <button class="footer-btn alert-btn" onclick="toggleAlertMenu()">
                <i class="fas fa-shield-alt"></i>
                <span>Alerta</span>
            </button>
        </footer>
        
        <!-- Men√∫ de Alerta (popup encima del footer) -->
        <div class="alert-menu-popup" id="alert-menu-popup">
            <button class="alert-option green" onclick="reportSuspect()">
                <i class="fas fa-eye"></i>
                <div class="alert-text">
                    <span class="alert-title">Sospecha</span>
                    <span class="alert-desc">Marcaje, vigilancia</span>
                </div>
            </button>
            <button class="alert-option amber" onclick="reportThreat()">
                <i class="fas fa-comment-dots"></i>
                <div class="alert-text">
                    <span class="alert-title">Amenaza</span>
                    <span class="alert-desc">WhatsApp, llamadas</span>
                </div>
            </button>
            <button class="alert-option red" onmousedown="startEmergency()" onmouseup="cancelEmergency()" ontouchstart="startEmergency()" ontouchend="cancelEmergency()">
                <div class="emergency-progress-bar" id="emergency-progress"></div>
                <i class="fas fa-exclamation-triangle"></i>
                <div class="alert-text">
                    <span class="alert-title">¬°EMERGENCIA!</span>
                    <span class="alert-desc">Mantener 3 seg</span>
                </div>
            </button>
        </div>
    </main>

    <!-- ========================================
         MODALS
    ======================================== -->
    
    <!-- Modal de Venta Exitosa -->
    <div class="modal" id="modal-sale-success">
        <div class="modal-content success">
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>¬°Venta Registrada!</h2>
            <p class="sale-amount" id="modal-sale-amount">S/. 0.00</p>
            <p class="sale-method" id="modal-sale-method">Efectivo</p>
            <div class="modal-actions">
                <button class="btn-modal secondary" onclick="printTicket('simple')">
                    <i class="fas fa-receipt"></i> Ticket Simple
                </button>
                <button class="btn-modal secondary" onclick="printTicket('electronic')">
                    <i class="fas fa-file-invoice"></i> Electr√≥nica
                </button>
                <button class="btn-modal primary" onclick="closeSaleModal()">
                    <i class="fas fa-arrow-right"></i> Siguiente
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Alerta de P√°nico -->
    <div class="modal" id="modal-panic">
        <div class="modal-content panic">
            <div class="modal-header-panic">
                <i class="fas fa-shield-alt"></i>
                <h2 id="panic-modal-title">Reportar Incidente</h2>
            </div>
            <div class="modal-body-panic" id="panic-modal-body">
                <!-- Contenido din√°mico seg√∫n nivel -->
            </div>
        </div>
    </div>


    <!-- Modal de resultados de b√∫squeda -->
    <div id="search-results-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Selecciona el producto</h3>
                <button onclick="closeSearchResultsModal()" class="modal-close">‚úï</button>
            </div>
            <div id="modal-products-grid" class="modal-products-grid"></div>
        </div>
    </div>


    <!-- Modal de BOT√ìN FIADO -->
     <div id="modal-fiado" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Seleccionar plazo de cr√©dito</h2>
            <div class="plazo-options">
                <button onclick="seleccionarPlazo(7)">7 d√≠as</button>
                <button onclick="seleccionarPlazo(15)">15 d√≠as</button>
                <button onclick="seleccionarPlazo(30)">30 d√≠as</button>
            </div>
            <input type="number" id="plazo-custom" placeholder="D√≠as personalizados">
            <button onclick="confirmarPlazoCustom()">Confirmar</button>
            <button onclick="cerrarModalFiado()">Cancelar</button>
        </div>
    </div>

    <!-- Modal de d√≠as de cr√©dito -->
    <div id="modal-dias-credito-overlay" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">¬øCu√°ntos d√≠as de cr√©dito?</div>
            
            <div class="modal-options">
                1 = 7 d√≠as<br>
                2 = 15 d√≠as<br>
                3 = 30 d√≠as
            </div>
            
            <div class="modal-input-group">
                <input 
                    type="number" 
                    id="modal-dias-input" 
                    class="modal-input" 
                    placeholder="Ingrese 1, 2, 3 o d√≠as personalizados"
                    min="1"
                    max="365"
                    autofocus
                >
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="cerrarModalDias()">
                    Cancelar
                </button>
                <button class="modal-btn modal-btn-primary" onclick="confirmarDias()">
                    Aceptar
                </button>
            </div>
        </div>
    </div>

<style>
.btn-plazo:hover {
    background: #667eea !important;
    color: white !important;
    border-color: #667eea !important;
    transform: translateY(-2px);
}
</style>


<script>
// ============================================
// FIADO - VARIABLES GLOBALES
// ============================================
let datosClienteFiado = null;
let diasCreditoSeleccionado = null;

// ============================================
// ABRIR MODAL
// ============================================
function abrirModalFiado() {
    const modal = document.getElementById('modal-fiado-overlay');
    if (modal) modal.style.display = 'flex';

    setTimeout(() => {
        document.getElementById('modal-fiado-nombre')?.focus();
    }, 100);

    diasCreditoSeleccionado = null;
    document.querySelectorAll('.btn-plazo-rapido').forEach(btn => {
        btn.classList.remove('selected');
    });
    const diasEl = document.getElementById('modal-fiado-dias');
    if (diasEl) diasEl.value = '';
}

// ============================================
// CERRAR MODAL
// ============================================
function cerrarModalFiado() {
    const modal = document.getElementById('modal-fiado-overlay');
    if (modal) modal.style.display = 'none';

    ['modal-fiado-nombre', 'modal-fiado-telefono', 'modal-fiado-direccion',
     'modal-fiado-referencia', 'modal-fiado-dias'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
    });

    datosClienteFiado = null;
    diasCreditoSeleccionado = null;
}

// ============================================
// BOTONES R√ÅPIDOS DE D√çAS
// ============================================
document.querySelectorAll('.btn-plazo-rapido').forEach(btn => {
    btn.onclick = function() {
        document.querySelectorAll('.btn-plazo-rapido').forEach(b => {
            b.classList.remove('selected');
        });
        this.classList.add('selected');
        diasCreditoSeleccionado = parseInt(this.dataset.dias);
        document.getElementById('modal-fiado-dias').value = '';
    };
});

// ============================================
// INPUT PERSONALIZADO
// ============================================
document.getElementById('modal-fiado-dias')?.addEventListener('input', function() {
    document.querySelectorAll('.btn-plazo-rapido').forEach(b => {
        b.classList.remove('selected');
    });
    diasCreditoSeleccionado = parseInt(this.value) || null;
});

// ============================================
// CONFIRMAR FIADO
// ============================================
function confirmarFiado() {
    const nombre = document.getElementById('modal-fiado-nombre').value.trim();
    const telefono = document.getElementById('modal-fiado-telefono').value.trim();
    const direccion = document.getElementById('modal-fiado-direccion').value.trim();

    if (!nombre) { alert('Ingresa el nombre del cliente'); document.getElementById('modal-fiado-nombre').focus(); return; }
    if (!telefono) { alert('Ingresa el tel√©fono del cliente'); document.getElementById('modal-fiado-telefono').focus(); return; }
    if (!direccion) { alert('Ingresa la direcci√≥n del cliente'); document.getElementById('modal-fiado-direccion').focus(); return; }

    const diasInput = document.getElementById('modal-fiado-dias').value;
    if (diasInput) diasCreditoSeleccionado = parseInt(diasInput);
    if (!diasCreditoSeleccionado || diasCreditoSeleccionado < 1) { alert('Selecciona el plazo de cr√©dito'); return; }

    datosClienteFiado = {
        nombre, telefono, direccion,
        referencia: document.getElementById('modal-fiado-referencia').value.trim(),
        dias: diasCreditoSeleccionado
    };

    cerrarModalFiado();
    processSale();
}

// ============================================
// CLICK FUERA DEL MODAL PARA CERRAR
// ============================================
document.getElementById('modal-fiado-overlay')?.addEventListener('click', function(e) {
    if (e.target === this) {
        cerrarModalFiado();
    }
});

// ============================================
// ESC PARA CERRAR
// ============================================
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('modal-fiado-overlay');
        if (modal && modal.style.display === 'flex') {
            cerrarModalFiado();
        }
    }
});
</script>
    
    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Audio Assistant -->
    <script src="/static/js/audio_assistant.js"></script>

    <!-- ‚úÖ M√ìDULOS DE VOZ (AGREGAR ESTO) -->
    <script src="/static/js/modules/voice-parser.js"></script>
    <script src="/static/js/modules/voice-commands.js"></script>
    <script src="/static/js/modules/voice-help.js"></script>
    <script src="/static/js/modules/ui-feedback.js"></script>
    <script src="/static/js/modules/fractional-sales.js"></script>
    <script src="/static/js/modules/cart-animations.js"></script>
    <script src="/static/js/modules/layered-variants.js"></script>

    <!-- Scripts -->
    <script src="/static/js/offline-db.js"></script>
    <script src="/static/js/offline-sync.js"></script>
    <script src="/static/js/offline-sale.js"></script>
    <script src="/static/js/dashboard_principal.js?v=20260223E"></script>

</body>
</html>